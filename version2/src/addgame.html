<!DOCTYPE html>

<!-- File Size: 5KB | Load Time: 2.07s -->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../style/style.css">
  <title>Add Game</title>
  <!-- changes -->
</head>

<body>
  <nav class="navbar">
    <a href="./home.html" id="logo">TeamWatch</a>
    <a href="./home.html">Home</a>
    <a href="./gameschedule.html">Game</a>
    <a href="./players.html">Roster</a>
    <a href="./login.html" id="logout" onclick="logoutClean()"> Logout</a>
  </nav>
  <div class="box">
    <h2 id="testid">Add Game</h2>
    <form id="addgameform">
      <p><label for="OppTeam">Opposing Team:</label></p>
      <input type="text" id="opponentteamname" name="OppTeam" placeholder="Enter Opposition Team Name">
      <br>
			<p><label for="gameDate">Date:</label></p>
			<p class="addgamenotice"><em>For the date, please put it in the fomat: mm/dd/yy (i.e. 11/25/17)</em></p>
      <input type="text" id="gamedate" name="gameDate" onblur="formatDate()" maxlength="8">
      <br>
      <p><label for="gametime">Time:</label></p>
      <p class="addgamenotice"><em>For the time, please put it in the format: hh:mm (i.e. 11:21) and then select am/pm below.</em></p>
      <p class="addgamenotice"><em>Note: Even if time is 01:01, please make sure to put 01:01 not 1:1.</em></p>      
      <input type="text" id="gametime" name="time" onblur="formatTime()" maxlength="5">
      <br>
      <p><label>Time of Day:</label></p>
      <input type="radio" name="tofday" value="day" id="timeofdayradio">A.M.<br>
      <input type="radio" name="tofday" value="night" id="timeofdayradio">P.M.<br>
      <br>
      <p><label for="location">Location:</label></p>
      <input type="text" id="gamelocation" name="location" placeholder="Enter Location">
      <br>
      <p><label>Status:</label></p>
      <input type="radio" name="status" value="Home" id="homeawaystatus">Home<br>
      <input type="radio" name="status" value="Away" id="homeawaystatus">Away<br>
      <hr>
      <input type="button" value="Add Game" id="egssaveBtn">
		</form>
	</div>
	
	<script>
	
		var sButton = document.getElementById('egssaveBtn'); 

    sButton.addEventListener('click', function() {

      var xdate = document.getElementById('gamedate').value; 
      if(!xdate) {
        alert('Please specify the date.'); 
        return false; 
      }

      var xtime = document.getElementById('gametime').value; 
      if(!xtime) {
        alert('Please specify the time.');
        return false; 
      }

      var timeChecker = xtime.indexOf(":"); 
      var timeChecker2 = xtime.lastIndexOf(":"); 
      if(!timeChecker || timeChecker != timeChecker2) {
        alert('Invalid time format. Please make sure to put time in HH:MM format.');
        return false; 
      }

      var tHour = xtime.slice(0, timeChecker); 
      var tMinute = xtime.slice(timeChecker + 1, xtime.length); 

      if(!tHour || !tMinute || tHour.length > 2 || tHour.length < 1 || tMinute.length > 2 || tMinute.length < 1) {
        alert('Invalid time format. Please make sure the hours and minutes have been input correctly.'); 
        return false; 
      }

      if( tHour > 12 || tMinute > 60 || tHour < 1 || tMinute < 0 ) {
        alert('Invalid time input. Please make sure hours and minutes are all appropriate values.'); 
        return false;
      }

      var dateChecker1 = xdate.indexOf("/"); 
      var dateChecker2 = xdate.lastIndexOf("/"); 

      if( !dateChecker1 || !dateChecker2 || dateChecker1 == dateChecker2 ) {
        alert('Invalid date format. Please check and write date according to format specified above input field.');
        return false; 
      }

      var dMonth = xdate.slice(0, dateChecker1); 
      var dDate = xdate.slice(dateChecker1 + 1, dateChecker2); 
      var dYear = xdate.slice(dateChecker2 + 1, xdate.length);

      if(!dMonth || !dDate || !dYear || dYear.length < 2 || dYear.length > 2 || 
          dMonth.length > 2 || dMonth.length < 1 || dDate.length > 2 || dDate.length < 1 || 
          dMonth > 12 || dDate > 31 || dYear < 17) {
        alert('Invalid date input. Please fix to continue'); 
        return false; 
      }

      if(isNaN(dMonth) || isNaN(dDate) || isNaN(dYear)) {
        alert('Date has to be in numerical format. Please refer to specified format above input field.'); 
        return false; 
      }

      alert('Month: ' + dMonth + " Date: " + dDate + "Year: " + dYear);   

      var tofd = document.querySelector('input[name=tofday]:checked').value; 
      if(!tofd) {
        alert('Please specify time of day.');
        return false;
      }

      var stts = document.querySelector('input[name=status]:checked').value; 
      if(!stts) { 
        alert('Please specify game status.'); 
        return false;
      }

      var lctn = document.getElementById('gamelocation').value; 
      if(!lctn) {
        alert('Please specify location of game.'); 
        return false;
      }

      var optm = document.getElementById('opponentteamname').value; 
      if(!optm) { 
        alert('Please specify opponent team name.'); 
        return false;
      }  

      var tod = document.querySelector('input[name=tofday]:checked').value; 
      var gTime = document.getElementById('gametime').value;

      var game = {}; 

      game.opponentname = document.getElementById('opponentteamname').value; 
      game.date = document.getElementById('gamedate').value; 

      if(tod == "day") {
        gTime = gTime.concat(" am");
      }
      if(tod == "night") {
        gTime = gTime.concat(" pm"); 
      }

      game.time = gTime; 
      game.tod = tod; 
    
      game.location = document.getElementById('gamelocation').value;
      game.status = document.querySelector('input[name=status]:checked').value; 

      var gamestats = {}
      gamestats.myfouls = "0"; 
      gamestats.opponentfouls = "0"; 
      gamestats.myredcards = "0"; 
      gamestats.opponentredcards = "0"; 
      gamestats.myyellowcards = "0"; 
      gamestats.opponentyellowcards = "0"; 
      gamestats.myshotsongoal = "0"; 
      gamestats.opponentshotsongoal = "0"; 
      gamestats.mygoals = "0"; 
      gamestats.opponentgoals = "0"; 
      gamestats.mycornerkicks = "0"; 
      gamestats.opponentcornerkicks = "0"; 
      gamestats.mygoalkicks = "0"; 
      gamestats.opponentgoalkicks = "0"; 

      game.stats = gamestats;

      var gamesArray = JSON.parse(localStorage.getItem('games')); 
      if(gamesArray) {
        gamesArray.push(game); 
        gamesArray.sort(function(a, b) {
		      return new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time);
        });
        localStorage.setItem('games', JSON.stringify(gamesArray)); 
      }
      else{
        var gameArr = [game]; 
        localStorage.setItem('games', JSON.stringify(gameArr));
      }
      location.href='./gameschedule.html';
    })

		function logoutClean() {
			localStorage.removeItem("user");
		}

    function formatDate(x) {
      x.value = x.value.slice(0,2) + "/" + x.value(2,4) + "/" + x.value(4,6); 
    }

    function formatTime(y) {
      y.value = y.value.slice(0,2) + ":" + y.value(2,4); 
    }

	</script>
</body>
</html>


<!--

  added radio button to indicate whether time is AM or PM. 
  later utilized for time storing and parsing for games.

 -->